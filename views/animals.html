<!DOCTYPE HTML>
<html>
	<head>
		<title>CRUD Animals - The World of Istv√°n Fekete</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			.pagination {
				margin-top: 20px;
				text-align: center;
			}
			.pagination a, .pagination span {
				display: inline-block;
				padding: 8px 16px;
				text-decoration: none;
				color: #d52349;
				border: 1px solid #ddd;
				margin: 0 4px;
				border-radius: 5px;
			}
			.pagination a.active {
				background-color: #d52349;
				color: white;
				border: 1px solid #d52349;
			}
			.pagination a:hover:not(.active) {
				background-color: #f3f3f3;
			}
			.pagination span.disabled {
				color: #ccc;
				border: 1px solid #eee;
				cursor: not-allowed;
			}
		</style>
	</head>
	<body class="is-preload">
		<div id="page-wrapper">
			<!-- Header -->
			<%- include('partials/header.html', { currentPage: 'animals-crud' }) %>

			<!-- Main -->
			<section id="main">
				<div class="container">
					<h2>Manage Animals</h2>

					<% if (typeof success !== 'undefined' && success) { %>
						<p style="color: green;"><%= success %></p>
					<% } %>
					<% if (typeof error !== 'undefined' && error) { %>
						<p style="color: red;"><%= error %></p>
					<% } %>

					<h3>Add New Animal</h3>
					<form action="/animals-crud/add" method="POST">
						<div class="row gtr-50">
							<div class="col-6 col-12-small">
								<input type="text" name="aname" placeholder="Animal Name" required />
							</div>
							<div class="col-6 col-12-small">
								<input type="text" name="species" placeholder="Species" required />
							</div>
							<div class="col-12">
								<ul class="actions">
									<li><input type="submit" class="button" value="Add Animal" /></li>
								</ul>
							</div>
						</div>
					</form>

					<h3>Current Animals</h3>
					<table>
						<thead>
							<tr>
								<th>ID</th>
								<th>Name</th>
								<th>Species</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<% if (typeof animals !== 'undefined' && animals.length > 0) { %>
								<% animals.forEach(function(animal) { %>
									<tr>
										<td><%= animal.id %></td>
										<td><%= animal.aname %></td>
										<td><%= animal.species %></td>
										<td>
											<button onclick="showEditForm(<%= animal.id %>, '<%= animal.aname %>', '<%= animal.species %>')">Edit</button>
											<form action="/animals-crud/delete" method="POST" style="display:inline;">
												<input type="hidden" name="id" value="<%= animal.id %>">
												<input type="hidden" name="page" value="<%= page %>">
												<button type="submit" onclick="return confirm('Are you sure you want to delete this animal?');">Delete</button>
											</form>
										</td>
									</tr>
								<% }); %>
							<% } else { %>
								<tr>
									<td colspan="4">No animals found.</td>
								</tr>
							<% } %>
						</tbody>
					</table>

					<div class="pagination">
						<span>Page <%= page %> of <%= totalPages %></span>
						<% if (page > 1) { %>
							<a href="?page=<%= page - 1 %>">Previous</a>
						<% } else { %>
							<span class="disabled">Previous</span>
						<% } %>
						<% for (let i = 1; i <= totalPages; i++) { %>
							<a href="?page=<%= i %>" class="<%= i === page ? 'active' : '' %>"><%= i %></a>
						<% } %>
						<% if (page < totalPages) { %>
							<a href="?page=<%= page + 1 %>">Next</a>
						<% } else { %>
							<span class="disabled">Next</span>
						<% } %>
					</div>

					<h3 id="edit-animal-heading" style="display:none;">Edit Animal</h3>
					<form action="/animals-crud/update" method="POST" id="edit-animal-form" style="display:none;">
						<input type="hidden" name="id" id="edit-animal-id">
						<input type="hidden" name="page" value="<%= page %>">
						<div class="row gtr-50">
							<div class="col-6 col-12-small">
								<input type="text" name="aname" id="edit-animal-aname" placeholder="Animal Name" required />
							</div>
							<div class="col-6 col-12-small">
								<input type="text" name="species" id="edit-animal-species" placeholder="Species" required />
							</div>
							<div class="col-12">
								<ul class="actions">
									<li><input type="submit" class="button" value="Update Animal" /></li>
									<li><input type="button" class="button alt" value="Cancel" onclick="hideEditForm()" /></li>
								</ul>
							</div>
						</div>
					</form>
				</div>
			</section>
		</div>

		<script>
			function showEditForm(id, aname, species) {
				document.getElementById('edit-animal-heading').style.display = 'block';
				document.getElementById('edit-animal-form').style.display = 'block';
				document.getElementById('edit-animal-id').value = id;
				document.getElementById('edit-animal-aname').value = aname;
				document.getElementById('edit-animal-species').value = species;
				window.scrollTo(0, document.body.scrollHeight); // Scroll to the bottom to show the form
			}

			function hideEditForm() {
				document.getElementById('edit-animal-heading').style.display = 'none';
				document.getElementById('edit-animal-form').style.display = 'none';
			}

			// Check for success/error messages in URL and display them
			document.addEventListener('DOMContentLoaded', () => {
				const urlParams = new URLSearchParams(window.location.search);
				const success = urlParams.get('success');
				const error = urlParams.get('error');

				if (success) {
					const successElement = document.createElement('p');
					successElement.style.color = 'green';
					successElement.textContent = success;
					document.querySelector('#main .container').prepend(successElement);
				}
				if (error) {
					const errorElement = document.createElement('p');
					errorElement.style.color = 'red';
					errorElement.textContent = error;
					document.querySelector('#main .container').prepend(errorElement);
				}
			});
		</script>
	</body>
</html>
